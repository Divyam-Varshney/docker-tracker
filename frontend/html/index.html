<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Docker Status Tracker | DevOps Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body {
            background-color: #171717;
            color: #e0e0e0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        .navbar {
            background-color: #1f1f1f !important;
            border-bottom: 2px solid #2c2c2c;
        }
        .card {
            background-color: #1f1f1f;
            border: 1px solid #2c2c2c;
            border-radius: 12px;
            transition: transform 0.2s;
        }
        .card:hover {
            transform: translateY(-5px);
        }
        .status-badge {
            font-size: 0.9rem;
            padding: 8px 16px;
            border-radius: 20px;
        }
        .status-running {
            background-color: #198754;
        }
        .status-stopped {
            background-color: #dc3545;
        }
        .status-warning {
            background-color: #ffc107;
            color: #000;
        }
        .table {
            color: #e0e0e0;
        }
        .table-dark {
            background-color: #1f1f1f;
        }
        .table-dark thead {
            background-color: #2c2c2c;
        }
        .btn-refresh {
            background-color: #0d6efd;
            border: none;
            padding: 10px 24px;
            border-radius: 8px;
        }
        .btn-refresh:hover {
            background-color: #0b5ed7;
        }
        .icon-box {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }
        .loading {
            display: none;
        }
        .spinner-border {
            width: 1.5rem;
            height: 1.5rem;
        }
    </style>
</head>
<body>
    <!-- Navbar -->
    <nav class="navbar navbar-dark">
        <div class="container-fluid">
            <span class="navbar-brand mb-0 h1">
                <i class="fas fa-docker"></i> Docker Status Tracker
            </span>
            <button class="btn btn-refresh" onclick="refreshData()">
                <i class="fas fa-sync-alt"></i> Refresh
                <span class="spinner-border loading ms-2" role="status"></span>
            </button>
        </div>
    </nav>

    <div class="container mt-4">
        <!-- System Status Cards -->
        <div class="row mb-4">
            <div class="col-md-3">
                <div class="card text-center p-3">
                    <div class="icon-box text-primary">
                        <i class="fas fa-server"></i>
                    </div>
                    <h6>NGINX Status</h6>
                    <span id="nginx-status" class="status-badge status-running">Loading...</span>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card text-center p-3">
                    <div class="icon-box text-success">
                        <i class="fas fa-database"></i>
                    </div>
                    <h6>Database Status</h6>
                    <span id="db-status" class="status-badge status-running">Loading...</span>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card text-center p-3">
                    <div class="icon-box text-info">
                        <i class="fab fa-docker"></i>
                    </div>
                    <h6>Running Containers</h6>
                    <h3 id="container-count" class="mt-2">-</h3>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card text-center p-3">
                    <div class="icon-box text-warning">
                        <i class="fas fa-network-wired"></i>
                    </div>
                    <h6>Open Ports</h6>
                    <h3 id="port-count" class="mt-2">-</h3>
                </div>
            </div>
        </div>

        <!-- Docker Containers Table -->
        <div class="card mb-4">
            <div class="card-header">
                <h5><i class="fab fa-docker"></i> Docker Containers</h5>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-dark table-hover">
                        <thead>
                            <tr>
                                <th>Container Name</th>
                                <th>Image</th>
                                <th>Status</th>
                                <th>Ports</th>
                                <th>Created</th>
                            </tr>
                        </thead>
                        <tbody id="containers-table">
                            <tr>
                                <td colspan="5" class="text-center">Loading containers...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Port Mapping Table -->
        <div class="card">
            <div class="card-header">
                <h5><i class="fas fa-plug"></i> Port Mapping & Availability</h5>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-dark table-hover">
                        <thead>
                            <tr>
                                <th>Port</th>
                                <th>Service</th>
                                <th>Status</th>
                                <th>Protocol</th>
                            </tr>
                        </thead>
                        <tbody id="ports-table">
                            <tr>
                                <td colspan="4" class="text-center">Loading port information...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <script>
        // API endpoint (NGINX reverse proxy se connect hoga)
        const API_BASE = '/api';

        // Page load hone par data fetch karo
        window.addEventListener('load', () => {
            refreshData();
        });

        // Main refresh function
        async function refreshData() {
            const spinner = document.querySelector('.spinner-border');
            spinner.style.display = 'inline-block';

            try {
                await Promise.all([
                    fetchSystemStatus(),
                    fetchContainers(),
                    fetchPorts()
                ]);
            } catch (error) {
                console.error('Error fetching data:', error);
                alert('Failed to fetch data. Check backend connection.');
            } finally {
                spinner.style.display = 'none';
            }
        }

        // System status fetch karo (NGINX, DB, etc.)
        async function fetchSystemStatus() {
            try {
                const response = await fetch(`${API_BASE}/status`);
                const data = await response.json();

                // NGINX status update karo
                const nginxBadge = document.getElementById('nginx-status');
                nginxBadge.textContent = data.nginx_status;
                nginxBadge.className = data.nginx_status === 'Running' 
                    ? 'status-badge status-running' 
                    : 'status-badge status-stopped';

                // Database status update karo
                const dbBadge = document.getElementById('db-status');
                dbBadge.textContent = data.db_status;
                dbBadge.className = data.db_status === 'Connected' 
                    ? 'status-badge status-running' 
                    : 'status-badge status-stopped';

            } catch (error) {
                console.error('Error fetching system status:', error);
            }
        }

        // Docker containers list fetch karo
        async function fetchContainers() {
            try {
                const response = await fetch(`${API_BASE}/containers`);
                const data = await response.json();

                const tbody = document.getElementById('containers-table');
                tbody.innerHTML = '';

                if (data.containers.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="5" class="text-center">No containers found</td></tr>';
                    document.getElementById('container-count').textContent = '0';
                    return;
                }

                document.getElementById('container-count').textContent = data.containers.length;

                data.containers.forEach(container => {
                    const row = `
                        <tr>
                            <td><i class="fab fa-docker me-2"></i>${container.name}</td>
                            <td>${container.image}</td>
                            <td><span class="status-badge ${container.status === 'running' ? 'status-running' : 'status-stopped'}">${container.status}</span></td>
                            <td>${container.ports || 'N/A'}</td>
                            <td>${container.created}</td>
                        </tr>
                    `;
                    tbody.innerHTML += row;
                });

            } catch (error) {
                console.error('Error fetching containers:', error);
            }
        }

        // Port information fetch karo
        async function fetchPorts() {
            try {
                const response = await fetch(`${API_BASE}/ports`);
                const data = await response.json();

                const tbody = document.getElementById('ports-table');
                tbody.innerHTML = '';

                if (data.ports.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="4" class="text-center">No port information available</td></tr>';
                    document.getElementById('port-count').textContent = '0';
                    return;
                }

                document.getElementById('port-count').textContent = data.ports.length;

                data.ports.forEach(port => {
                    const row = `
                        <tr>
                            <td><strong>${port.port}</strong></td>
                            <td>${port.service}</td>
                            <td><span class="status-badge ${port.status === 'Open' ? 'status-running' : 'status-stopped'}">${port.status}</span></td>
                            <td>${port.protocol}</td>
                        </tr>
                    `;
                    tbody.innerHTML += row;
                });

            } catch (error) {
                console.error('Error fetching ports:', error);
            }
        }

        // Auto-refresh every 10 seconds
        setInterval(refreshData, 10000);
    </script>
</body>
</html>
